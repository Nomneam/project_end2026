{% extends "layout/admin-layout.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
{% endblock %}

{% block content %}
<div class="main-content">
  <div class="container-fluid">

    <h2 class="mb-4"> Dashboard Admin</h2>

    <div class="row">
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-value text-success">{{ online_count }}</div>
          <div class="stat-label">ผู้ใช้งานออนไลน์</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-value text-secondary">{{ offline_count }}</div>
          <div class="stat-label">ผู้ใช้งานออฟไลน์</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-value text-primary">{{ total_staff }}</div>
          <div class="stat-label">จำนวนพนักงานทั้งหมด</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-value text-danger">{{ pending_ads_count }}</div>
          <div class="stat-label">โฆษณาที่รออนุมัติ</div>
        </div>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-danger text-white">การเข้าใช้งานของผู้ใช้</div>
          <div class="card-body">
            <div class="chart-container" style="position: relative; height:300px;">
              <canvas id="userActivityChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-danger text-white">โฆษณาทั้งหมดในเว็บ</div>
          <div class="card-body">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>โฆษณา</th>
                  <th>สถานะ</th>
                </tr>
              </thead>
              <tbody>
                {% for ad in adverts %}
                <tr>
                  <td>{{ ad.adv_name }}</td>
                  <td>
                    {% if ad.status == 'approved' %}
                      <span class="badge bg-success">อนุมัติแล้ว</span>
                    {% elif ad.status == 'submitted' %}
                      <span class="badge bg-warning text-dark">รออนุมัติ</span>
                    {% else %}
                      <span class="badge bg-secondary">{{ ad.status }}</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4 mb-5">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header bg-danger text-white">จัดการผู้ใช้งาน</div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped align-middle">
                <thead>
                  <tr>
                    <th>ชื่อ-นามสกุล</th>
                    <th>อีเมล</th>
                    <th>บทบาท</th>
                    <th>จัดการ</th>
                  </tr>
                </thead>
                <tbody>
                  {% for emp in employees %}
                  <tr>
                    <td>{{ emp.emp_fname }} {{ emp.emp_lname }}</td>
                    <td>{{ emp.emp_email }}</td>
                    <td>
                        {% if emp.role_id == 1 %}
                            <span class="badge bg-danger">Admin</span>
                        {% elif emp.role_id == 2 %}
                            <span class="badge bg-primary">Reporter</span>
                        {% elif emp.role_id == 3 %}
                            <span class="badge bg-warning">Owner</span>
                        {% else %}
                            <span class="badge bg-light text-dark">Staff</span>
                        {% endif %}
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    new Chart(document.getElementById('userActivityChart'), {
      type: 'pie',
      data: {
        labels: ['ออนไลน์', 'ออฟไลน์'],
        datasets: [{
          // ตรงนี้คงไว้เป็นค่า Static ตามที่คุณต้องการ
          data: [18, 10], 
          backgroundColor: ['#198754', '#6c757d'],
          borderWidth: 0
        }]
      },
      options: {
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  });
</script>
{% endblock %}