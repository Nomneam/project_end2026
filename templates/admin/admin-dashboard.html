{% extends "layout/admin-layout.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
{% endblock %}

{% block content %}
<div class="main-content">
  <div class="container-fluid">

    <h2 class="mb-4"> Dashboard Admin</h2>

  <div class="row">
    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-value text-success">üü¢ {{ online_count }}</div>
        <div class="stat-label">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-value text-secondary">‚ö™ {{ offline_count }}</div>
        <div class="stat-label">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-value text-primary">üë• {{ total_staff }}</div>
        <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-value text-info">üì¢ {{ published_ads_count }}</div>
          <div class="stat-label">‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
        </div>
      </div>
    </div>   

    <div class="col-md-3">
      <div class="stat-card">
        <div class="stat-value text-danger">‚è≥ {{ pending_ads_count }}</div>
        <div class="stat-label">‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
      </div>
    </div>
  </div>

    <div class="row mt-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-danger text-white">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
          <div class="card-body">
            <div class="chart-container" style="position: relative; height:300px;">
              <canvas id="userActivityChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-danger text-white">‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö</div>
          <div class="card-body">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</th>
                  <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
              </thead>
              <tbody>
                {% for ad in adverts %}
                <tr>
                  <td>{{ ad.adv_name }}</td>
                  <td>
                    {% if ad.status == 'approved' %}
                      <span class="badge bg-success">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                    {% elif ad.status == 'submitted' %}
                      <span class="badge bg-warning text-dark">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                    {% else %}
                      <span class="badge bg-secondary">{{ ad.status }}</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4 mb-5">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header bg-danger text-white">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô online</div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped align-middle">
                <thead>
                  <tr>
                    <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                    <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                    <th>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                  </tr>
                </thead>
                <tbody>
                  {% for emp in employees %}
                    {# ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô online_count #}
                    {% if loop.index <= online_count %}
                    <tr>
                      <td>{{ emp.emp_fname }} {{ emp.emp_lname }}</td>
                      <td>{{ emp.emp_email }}</td>
                      <td>
                          {% if emp.role_id == 1 %}
                              <span class="badge bg-danger">Admin</span>
                          {% elif emp.role_id == 2 %}
                              <span class="badge bg-primary">Reporter</span>
                          {% elif emp.role_id == 3 %}
                              <span class="badge bg-warning">Owner</span>
                          {% else %}
                              <span class="badge bg-light text-dark">Staff</span>
                          {% endif %}
                      </td>
                      <td>
                        <button class="btn btn-sm btn-outline-primary shadow-sm" 
                                data-bs-toggle="modal" 
                                data-bs-target="#empDetailModal{{ emp.emp_id }}"
                                title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                          <i class="bi bi-eye"></i>
                        </button>
                      </td>
                    </tr>
                    {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal for employee details -->
{% for emp in employees %}
  {% if loop.index <= online_count %}
  <div class="modal fade" id="empDetailModal{{ emp.emp_id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg" style="border-radius: 15px;">
        
        <div class="modal-header bg-danger text-white border-0" style="border-radius: 15px 15px 0 0;">
          <h5 class="modal-title">
            <i class="bi bi-person-vcard me-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body p-4">
          <div class="text-center mb-4">
            <div class="avatar-placeholder mb-2 mx-auto d-flex align-items-center justify-content-center bg-light rounded-circle" style="width: 80px; height: 80px; border: 2px solid #dc3545;">
              <i class="bi bi-person text-danger" style="font-size: 2.5rem;"></i>
            </div>
            <h4 class="mb-0">{{ emp.emp_fname }} {{ emp.emp_lname }}</h4>
            
            {% if emp.role_id == 1 %}
              <span class="badge bg-danger"> Admin</span>
            {% elif emp.role_id == 2 %}
              <span class="badge bg-primary"> Reporter</span>
            {% elif emp.role_id == 3 %}
              <span class="badge bg-warning text-dark"> Owner</span>
            {% endif %}
          </div>

          <hr class="text-muted opacity-25">

          <div class="row g-3">
            <div class="col-6">
              <label class="text-muted small d-block">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
              <span class="fw-bold">{{ emp.emp_email }}</span>
            </div>
            <div class="col-6">
              <label class="text-muted small d-block">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
              <span class="fw-bold text-danger">{{ emp.emp_code if emp.emp_code else '-' }}</span>
            </div>
            <div class="col-6">
              <label class="text-muted small d-block">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
              <span class="text-success"><i class="bi bi-circle-fill me-1 small"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0 p-3">
          <button type="button" class="btn btn-light w-100 py-2 shadow-sm" data-bs-dismiss="modal" style="border-radius: 10px;">‡∏õ‡∏¥‡∏î</button>
        </div>

      </div>
    </div>
  </div>
  {% endif %}
{% endfor %}
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    new Chart(document.getElementById('userActivityChart'), {
      type: 'pie',
      data: {
        labels: ['‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå', '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå'],
        datasets: [{
          // ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ Static ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
          data: [18, 10], 
          backgroundColor: ['#198754', '#6c757d'],
          borderWidth: 0
        }]
      },
      options: {
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  });
</script>
{% endblock %}